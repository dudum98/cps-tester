<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CPS Test — Correct Flow</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg1:#0f172a;--bg2:#0b1220;--card:#0f172a;--accent1:#7c3aed;--accent2:#06b6d4;--muted:#9aa4b2}
*{box-sizing:border-box}
body{font-family:Inter,Arial,Helvetica,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#e6eef8;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:12px}
.container{width:100%;max-width:760px;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(2,6,23,0.6);min-height:calc(100vh - 28px);display:flex;flex-direction:column;justify-content:center}
h1{margin:0 0 6px;font-weight:600}
p.lead{color:var(--muted);margin-top:6px}
.controls{display:flex;flex-wrap:wrap;align-items:center;gap:8px;margin:12px 0}
select,button{border-radius:10px;border:0;padding:8px 12px;font-size:15px}
button{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;box-shadow:0 6px 18px rgba(12,18,35,0.6)}
button:disabled{opacity:0.5;filter:grayscale(30%)}
.progressContainer{width:100%;height:12px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden}
#progressBar{height:100%;width:100%;background:linear-gradient(90deg,#4caf50,#8bc34a);transition:width 0.1s linear}
#box{width:min(320px,38vh);height:min(320px,38vh);margin:12px auto;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:calc(14px + 1.8vw);background:linear-gradient(135deg,#0b1220,#091025);cursor:pointer;box-shadow:0 10px 30px rgba(2,6,23,0.6);user-select:none;transition:transform 0.08s ease, box-shadow 0.12s ease}
#box.active{animation:pop 0.9s infinite cubic-bezier(.36,.07,.19,.97)}
@keyframes pop{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}
#box:hover{transform:translateY(-6px)}
#timer{font-size:18px;color:#d7e7fb;margin-top:6px}
#result{font-size:18px;margin-top:8px;color:#fff}
#clickCount{font-size:16px;color:#cfe9ff;margin-top:6px}
#instructions{color:rgba(230,238,248,0.9)}
#highScores{margin-top:10px;color:var(--muted)}
#confettiCanvas{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:999}
@media(max-width:480px){#box{width:46vw;height:46vw;font-size:18px}}
</style>
</head>
<body>

<div class="container">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div>
      <h1>Click Speed Test (CPS)</h1>
      <p class="lead">Select time, choose a mode, then click the box to start.</p>
      <div style="margin-top:12px;color:#bcd9f2;line-height:1.5;max-width:680px">
        <p><strong>About this tool:</strong> This Clicks Per Second (CPS) tester helps you measure and practice your click speed with multiple game-style modes (Standard, Jitter, Butterfly, Kohi, Hold-Click and Double Click). No account or server-side tracking is required — tests run in your browser.</p>
        <p>This site stores only minimal data locally (high scores are saved to your browser's <code>localStorage</code> so they persist across visits). For details, see our <a href="privacy.html" style="color:#dbeeff">Privacy Policy</a>. By using the tester you agree to the <a href="terms.html" style="color:#dbeeff">Terms</a>.</p>
      </div>
    </div>
  </div>

  <div class="controls">
    <select id="time">
      <option value="1">1 Second</option>
      <option value="5" selected>5 Seconds</option>
      <option value="10">10 Seconds</option>
    </select>

    <select id="mode">
      <option value="standard" selected>Standard</option>
      <option value="jitter">Jitter Test</option>
      <option value="butterfly">Butterfly Test</option>
      <option value="kohi">Kohi Test</option>
      <option value="hold">Hold-Click Test</option>
      <option value="double">Double Click Test</option>
    </select>

    <button id="tryAgain">Try Again</button>
  </div>

  <details id="instructions" style="max-width:720px;margin:6px 0 12px;text-align:left;font-size:15px;color:#9fb9d6;padding:6px;border-radius:8px;background:rgba(255,255,255,0.01)">
    <summary style="cursor:pointer;font-weight:600">How to play (click to expand)</summary>
    <ul style="margin:8px 16px">
      <li><strong>Standard:</strong> click to count.</li>
      <li><strong>Jitter:</strong> box moves randomly per click.</li>
      <li><strong>Butterfly:</strong> must alternate left/right halves to count.</li>
      <li><strong>Kohi:</strong> counts clicks spaced &gt;= 35ms to emulate rhythm checks.</li>
      <li><strong>Hold-Click:</strong> hold mouse down — clicks increment while held.</li>
      <li><strong>Double Click:</strong> double-click (two clicks counted) using dblclick.</li>
    </ul>
  </details>

  <div style="display:flex;gap:16px;align-items:center;justify-content:center;flex-direction:column">
    <div id="timer">Time: 0</div>
    <div class="progressContainer" style="width:320px"><div id="progressBar"></div></div>
    <div id="box">Start</div>
    <div id="clickCount">Clicks: 0</div>
    <div id="result"></div>
    <div id="highScores"></div>
  </div>

  <canvas id="confettiCanvas"></canvas>
</div>

  <footer style="position:fixed;left:50%;transform:translateX(-50%);bottom:8px;padding:6px 10px;border-radius:8px;background:rgba(2,6,23,0.6);color:rgba(230,238,248,0.9);font-size:13px">
    <small>© 2025 CPS Tester — <a href="privacy.html" style="color:#cfe9ff">Privacy Policy</a> • <a href="terms.html" style="color:#cfe9ff">Terms</a></small>
  </footer>

<script>
let clicks = 0;
let timerInterval = null;
let testActive = false;
let allowStart = true; // first click allowed to start
let currentDuration = 0;
let endTime = 0;
let holdInterval = null;
let lastClickTime = 0;
let lastSide = null;

const box = document.getElementById("box");
const result = document.getElementById("result");
const timerEl = document.getElementById("timer");
const clickCountEl = document.getElementById("clickCount");
const timeSelect = document.getElementById("time");
const modeSelect = document.getElementById("mode");
const tryAgain = document.getElementById("tryAgain");
const progressBar = document.getElementById("progressBar");
const highScoresEl = document.getElementById("highScores");
const confettiCanvas = document.getElementById("confettiCanvas");
const confettiCtx = confettiCanvas.getContext('2d');

// resize confetti canvas
function resizeCanvas(){
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Initially Try Again is disabled because first test starts by clicking the box
tryAgain.disabled = true;

// High score helpers: store per-mode scores in localStorage
function keyForMode(mode) { return 'cps_scores_' + mode; }
function loadScores(mode) {
  try { const raw = localStorage.getItem(keyForMode(mode)); return raw ? JSON.parse(raw) : []; } catch (e) { return []; }
}
function saveScore(mode, score) {
  const scores = loadScores(mode);
  scores.push(score);
  while (scores.length > 20) scores.shift();
  localStorage.setItem(keyForMode(mode), JSON.stringify(scores));
}
function getBest(mode) { const s = loadScores(mode); return s.length ? Math.max(...s) : 0; }
function getAverage(mode) { const s = loadScores(mode); return s.length ? (s.reduce((a,b)=>a+b,0)/s.length) : 0; }
function updateHighScoresUI(mode) {
  const best = getBest(mode).toFixed(2);
  const avg = getAverage(mode).toFixed(2);
  highScoresEl.textContent = `Mode: ${mode} — Best CPS: ${best} | Avg CPS: ${avg}`;
}

function updateClicksUI(){ clickCountEl.textContent = 'Clicks: ' + clicks; }

// confetti simple implementation
function fireConfetti(x,y){
  const particles = [];
  const colors = ['#ffec99','#fbcfe8','#a7f3d0','#bfdbfe','#fde68a'];
  for(let i=0;i<80;i++){
    particles.push({
      x, y,
      vx:(Math.random()-0.5)*8,
      vy:(Math.random()-1.5)*8,
      size: Math.random()*6+4,
      color: colors[Math.floor(Math.random()*colors.length)],
      rot: Math.random()*360,
      life: 60 + Math.random()*40
    });
  }
  let frame = 0;
  function draw(){
    confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    for(let p of particles){
      p.x += p.vx; p.y += p.vy; p.vy += 0.18; p.life--; p.rot += 6;
      confettiCtx.save();
      confettiCtx.translate(p.x,p.y);
      confettiCtx.rotate(p.rot * Math.PI/180);
      confettiCtx.fillStyle = p.color;
      confettiCtx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6);
      confettiCtx.restore();
    }
    frame++;
    if(frame < 140){ requestAnimationFrame(draw); }
    else { confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }
  }
  draw();
}

// Start a test
function startTest() {
  if (!allowStart) return;
  clicks = 0; updateClicksUI();
  currentDuration = parseFloat(timeSelect.value);
  endTime = Date.now() + currentDuration * 1000;
  testActive = true; allowStart = false;
  box.textContent = 'Click!'; box.classList.add('active'); result.textContent = '';
  tryAgain.disabled = true; updateHighScoresUI(modeSelect.value);

  timerInterval = setInterval(()=>{
    const remaining = Math.max(0,(endTime - Date.now())/1000);
    timerEl.textContent = 'Time: ' + remaining.toFixed(1);
    const pct = Math.max(0,Math.min(1,remaining/currentDuration));
    progressBar.style.width = (pct*100) + '%';
    if(remaining <= 0){
      clearInterval(timerInterval); testActive = false; if(holdInterval){ clearInterval(holdInterval); holdInterval=null }
      const cps = (clicks / currentDuration); result.textContent = 'Your CPS: ' + cps.toFixed(2);
      box.textContent = 'Test Finished!'; timerEl.textContent = 'Time: 0'; progressBar.style.width = '0%'; tryAgain.disabled = false;
      saveScore(modeSelect.value, cps); updateHighScoresUI(modeSelect.value);
      // confetti at box center
      const rect = box.getBoundingClientRect(); fireConfetti(rect.left + rect.width/2, rect.top + rect.height/2);
      box.classList.remove('active');
    }
  }, 100);
}

// helper to increment clicks and update UI safely
function addClicks(n){ clicks += n; updateClicksUI(); }

// Helpers for mode behaviors
function handleBoxClick(e){
  if(!testActive && allowStart){ startTest(); return; }
  if(!testActive) return;
  const mode = modeSelect.value; const now = Date.now();
  if(mode === 'standard'){ addClicks(1); }
  else if(mode === 'jitter'){ addClicks(1); const dx=(Math.random()-0.5)*120; const dy=(Math.random()-0.5)*120; box.style.transform = `translate(${dx}px, ${dy}px)`; }
  else if(mode === 'butterfly'){ const rect = box.getBoundingClientRect(); const relX = e.clientX - rect.left; const side = (relX < rect.width/2) ? 'L':'R'; if(lastSide === null || side !== lastSide){ addClicks(1); lastSide = side } box.style.transform = `scaleX(${side==='L'?1:-1})`; }
  else if(mode === 'kohi'){ if(!lastClickTime || (now - lastClickTime) >= 35){ addClicks(1); } lastClickTime = now; }
  else if(mode === 'double'){ /* single clicks ignored; dblclick handler handles */ }
}

// dblclick handler for Double Click Test
box.addEventListener('dblclick', (e)=>{ if(!testActive) return; if(modeSelect.value === 'double'){ addClicks(2); } });

// mousedown / touchstart handlers for Hold-Click Test
function beginHoldIfNeeded() {
  if (modeSelect.value === 'hold') {
    addClicks(1);
    if (holdInterval) clearInterval(holdInterval);
    holdInterval = setInterval(() => addClicks(1), 100);
  }
}

box.addEventListener('mousedown', (e) => {
  if (!testActive) {
    if (allowStart) startTest();
    // if mode is hold, start counting immediately on the same press
    if (allowStart && modeSelect.value === 'hold' && testActive) beginHoldIfNeeded();
    return;
  }
  beginHoldIfNeeded();
});

box.addEventListener('touchstart', (e) => {
  e.preventDefault();
  if (!testActive) {
    if (allowStart) startTest();
    if (allowStart && modeSelect.value === 'hold' && testActive) beginHoldIfNeeded();
    return;
  }
  beginHoldIfNeeded();
}, {passive:false});

function endHoldIfNeeded() { if (holdInterval) { clearInterval(holdInterval); holdInterval = null; } }
box.addEventListener('mouseup', endHoldIfNeeded);
box.addEventListener('touchend', endHoldIfNeeded);
box.addEventListener('mouseleave', endHoldIfNeeded);

// Attach click handler
box.addEventListener('click', handleBoxClick);

// Try Again button resets box to Start
tryAgain.onclick = ()=>{
  box.textContent = 'Start'; result.textContent = ''; timerEl.textContent = 'Time: 0'; testActive = false; allowStart = true; tryAgain.disabled = true;
  progressBar.style.width = '100%'; box.style.transform = 'none'; lastClickTime = 0; lastSide = null; clicks=0; updateClicksUI(); updateHighScoresUI(modeSelect.value);
}

// Update high scores when mode changes
modeSelect.addEventListener('change', ()=> updateHighScoresUI(modeSelect.value));

// initialize
progressBar.style.width = '100%'; updateHighScoresUI(modeSelect.value); updateClicksUI();
</script>

</body>
</html>
